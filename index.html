<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Etapas de la vida</title>
<style>
  /* ====== Reset & base ====== */
  * { box-sizing: border-box; margin:0; padding:0; }
  :root{
    --blue:#001DFF;
    --blue-dark:#04032B;
    --blue-700:#1a3a5f;
    --blue-600:#254fba;
    --orange:#f59e42;
    --orange-700:#e67e22;
    --bg-grad-1:#1a3a5f;
    --bg-grad-2:#0d2340;
    --white:#ffffff;
    --green:#2ecc71;
    --red:#e74c3c;
    --panel:#E8EAFF;
  }
  body{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
    min-height:100vh; display:flex; justify-content:center; align-items:center; color:#333; padding:10px;
  }
  .game-container{
    background:var(--white); border-radius:16px; box-shadow:0 12px 24px rgba(0,0,0,.12);
    padding:1.2rem; max-width:980px; width:100%; min-height:640px; position:relative; overflow:hidden;
    display:flex; flex-direction:column;
  }
  header{ text-align:center; margin-bottom:.8rem; margin-top:2rem; }
  h1{ color:var(--blue-dark); font-size:clamp(2rem,5.2vw,3.1rem); font-weight:900; letter-spacing:.5px; }
  .subtitle{ color:var(--blue-700); font-size:clamp(1rem,3.5vw,1.25rem); margin-top:.25rem; }
  .highlight-keyword{ color:var(--orange); font-weight:800; }

  .btn{ color:#fff; border:none; padding:.75rem 1.2rem; border-radius:10px; cursor:pointer; font-weight:800;
        transition:transform .08s ease, box-shadow .2s ease, background-color .25s ease; min-width:140px; height:48px;
        display:inline-flex; align-items:center; justify-content:center; }
  .btn:hover{ transform:translateY(-2px); box-shadow:0 6px 14px rgba(0,0,0,.12); }
  .btn:active{ transform:translateY(0); }
  .btn-primary{ background:var(--orange); }
  .btn-primary:hover{ background:var(--orange-700); }
  .btn-blue{ background:var(--blue-600); }
  .btn-blue:hover{ filter:brightness(.9); }
  .btn-ghost{ background:#e6f2ff; color:var(--blue-700); }

  .screen{ display:none; animation:fadeIn .35s ease; }
  .screen.active{ display:block; }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(12px);} to{opacity:1; transform:translateY(0);} }

  .game-info{ display:flex; gap:.6rem; align-items:center; justify-content:space-between; margin:.4rem 0 1rem; flex-wrap:wrap; }
  .timer{ font-weight:900; color:var(--blue-700); font-size:clamp(.95rem,2.3vw,1.15rem); }
  .progress-bar{ flex:1; height:10px; background:#e6f2ff; border-radius:999px; overflow:hidden; }
  .progress-fill{ height:100%; width:0%; background:linear-gradient(90deg, var(--orange) 0%, var(--orange-700) 100%); transition:width .3s ease; }
  .score{ font-weight:900; color:var(--blue-700); font-size:clamp(.9rem,2.3vw,1.1rem); }

  .start-content{ display:flex; flex-direction:column; justify-content:center; align-items:center; flex:1; gap:1rem; padding:1rem; }
  .advice-box{ background:var(--panel); border-left:4px solid var(--blue-700); padding:1rem 1.2rem; border-radius:12px;
               color:var(--blue-700); max-width:760px; text-align:center; font-size:clamp(1rem,3vw,1.15rem); }
  .start-image{ max-width: 300px; width: 100%; margin: 0 auto; }

  .mute-btn{ position:absolute; top:.8rem; right:4.5rem; background:var(--orange); color:#fff; border:2px solid #fff; width:38px; height:38px; border-radius:50%; cursor:pointer; font-size:1rem; display:flex; align-items:center; justify-content:center; z-index:20; }
  .mute-btn:hover{ background:var(--orange-700); }

  .quiz-container {
    padding: 20px;
    text-align: center;
  }

  .quiz-question {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    font-size: 1.2rem;
    color: #333;
    text-align: center;
    border-left: 5px solid var(--blue);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .quiz-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
  }

  .quiz-option {
    background-color: #E8EAFF;
    color: #001DFF;
    border: 3px solid transparent;
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-weight: bold;
  }

  .quiz-option:hover {
    background-color: #D0D4FF;
    transform: translateY(-2px);
  }

  .quiz-option.correct {
    background-color: #27ae60;
    color: white;
    border-color: #27ae60;
  }

  .quiz-option.incorrect {
    background-color: #e74c3c;
    color: white;
    border-color: #e74c3c;
  }

  .results{ display:flex; flex-direction:column; align-items:center; gap:.6rem; text-align:center; min-height:calc(100vh - 180px); }
  .final-title{ color:var(--blue-dark); font-weight:900; }
  .big-score{ font-size:clamp(2.2rem,6vw,3.4rem); color:var(--blue-600); font-weight:900; }
  .score-title{ font-size:1.0rem; color:var(--blue-700); margin-top:1rem; }
  .final-time{ color:var(--blue-700); }
  .trophy{ font-size:clamp(4rem,10vw,6rem); margin:.2rem 0; color:var(--orange); animation:bounce 1s ease infinite; }
  @keyframes bounce { 0%,100%{ transform:translateY(0);} 50%{ transform:translateY(-8px);} }
  .credit{ color:var(--blue-700); margin-top:1rem; }

  /* Tama√±o del mensaje final (un poco menor que el t√≠tulo final) */
  #finalMsg {
    font-size: clamp(1.6rem, 3.8vw, 2.4rem);
    font-weight: 800;
    color: var(--blue-700);
    margin-top: 0.6rem;
  }

  /* Estilos para el logo del colegio en la pantalla final */
  .school-logo {
    display: block;
    width: 160px;       /* ancho por defecto en pantallas grandes */
    max-width: 28%;     /* evita que crezca demasiado en pantallas muy anchas */
    height: auto;
    margin-top: 0.8rem;
    border-radius: 8px; /* opcional, suaviza esquinas si la imagen lo permite */
    object-fit: contain;
  }

  /* Ajustes responsivos para m√≥viles */
  @media (max-width: 899px) {
    .school-logo { width: 140px; max-width: 160px; }
  }
  @media (max-width: 420px) {
    .school-logo { width: 110px; max-width: 40%; margin-top: 0.6rem; }
    .results { gap: 0.4rem; padding: 0 0.6rem; }
    #finalMsg { font-size: clamp(1.2rem, 4.2vw, 1.8rem); }
    .big-score { font-size: clamp(1.8rem, 6vw, 2.6rem); }
    .quiz-options {
      grid-template-columns: 1fr;
    }
  }
  @media (max-width: 320px) {
    .school-logo { width: 90px; max-width: 48%; }
    #finalMsg { font-size: clamp(1.1rem, 4.6vw, 1.6rem); }
  }

  .confetti{ position:fixed; width:10px; height:10px; border-radius:50%; animation: confetti-fall 3s linear forwards; z-index:999; }
  @keyframes confetti-fall{ 0%{ transform:translate(0, -20px) rotate(0); opacity:1;} 100%{ transform:translate(var(--tx), var(--ty)) rotate(360deg); opacity:0; } }

  .hidden {
    display: none;
  }

  .theory-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  .theory-content {
    background-color: #f8f9fa;
    padding: 25px;
    border-radius: 15px;
    margin: 25px 0;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border-left: 6px solid var(--blue);
    font-size: 1.15rem;
    line-height: 1.8;
  }

  .theory-title {
    color: var(--blue-dark);
    font-size: 1.8rem;
    font-weight: 900;
    margin-bottom: 25px;
    text-align: center;
    letter-spacing: 0.5px;
    position: relative;
    padding-bottom: 15px;
  }

  .theory-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, var(--orange), var(--blue));
    border-radius: 2px;
  }

  .stage-item {
    margin-bottom: 20px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,245,255,0.9));
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    border-left: 4px solid var(--orange);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .stage-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  .stage-range {
    color: var(--blue);
    font-size: 1.3rem;
    font-weight: 800;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
  }

  .stage-range::before {
    content: '‚ñ∏';
    color: var(--orange);
    font-size: 1.5rem;
    margin-right: 10px;
  }

  .stage-name {
    color: #555;
    font-size: 1.1rem;
    font-style: italic;
    padding-left: 25px;
    margin-bottom: 5px;
  }

  .stage-feature {
    color: #666;
    font-size: 1rem;
    padding-left: 25px;
    margin-top: 5px;
    font-style: normal;
  }

  .game-instruction {
    font-size: 1.5rem;
    color: var(--blue);
    margin: 20px 0;
    font-weight: bold;
    text-align: center;
  }

  .level-indicator {
    font-weight: 900;
    color: var(--blue-700);
    font-size: 1.2rem;
    margin: 10px 0;
  }

  .attempts {
    font-weight: 900;
    color: var(--blue-700);
    font-size: clamp(1rem, 2.3vw, 1.15rem);
  }

  .marker.clicked-temp { transform: translate(-50%, -50%) scale(.95); transition: transform .12s ease; }

  /* Nuevo estilo para el consejo, centrado y en dos l√≠neas */
  .advice-box .advice-text {
      display: block;
  }
  .advice-box strong {
      display: block;
      margin-top: 0.5rem;
      text-align: center;
      font-size: 0.9rem; /* Tama√±o de fuente m√°s peque√±o para el mensaje de √°nimo */
  }
</style>
</head>
<body>
<div class="game-container">
  <button class="mute-btn" id="muteBtn" title="Silenciar/Activar sonido">üîä</button>

  <!-- Main Menu Screen -->
  <section class="screen active" id="startScreen" aria-labelledby="title">
    <header>
      <h1 id="title">Etapas de la vida</h1>
      <div class="subtitle">Identifica las diferentes etapas de la vida</div>
    </header>
    <div class="start-content">
      <div class="advice-box" role="note" aria-live="polite">
        <span class="advice-text">Adivina la <span class="highlight-keyword">etapa de la vida</span> correspondiente a cada descripci√≥n.</span>
        <strong>¬°Buena suerte!</strong>
      </div>
      <button class="btn btn-primary" id="playBtn">Comenzar a aprender</button>
      <img class="start-image" src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/main/Ni%C3%B1os.png" alt="Ni√±os aprendiendo">
    </div>
  </section>

  <!-- Theory Screen -->
  <section class="screen" id="theoryScreen">
    <div class="theory-container">
      <h1 class="title">Etapas de la vida</h1>
      <div class="theory-content">
        <h2 class="theory-title">Las etapas de la vida humana</h2>
        
        <div class="stage-item">
          <div class="stage-range">0 ‚Äì 11 a√±os</div>
          <div class="stage-name">Infancia</div>
          <div class="stage-feature">Pasamos de beb√©s a ni√±os y ni√±as.</div>
        </div>
        
        <div class="stage-item">
          <div class="stage-range">12 ‚Äì 15 a√±os</div>
          <div class="stage-name">Adolescencia</div>
          <div class="stage-feature">Cambios f√≠sicos: vello corporal, barba, senos, etc.</div>
        </div>
        
        <div class="stage-item">
          <div class="stage-range">16 ‚Äì 25 a√±os</div>
          <div class="stage-name">Juventud</div>
          <div class="stage-feature">Fin de los cambios f√≠sicos.</div>
        </div>
        
        <div class="stage-item">
          <div class="stage-range">26 ‚Äì 70 a√±os</div>
          <div class="stage-name">Adulto</div>
          <div class="stage-feature">Per√≠odo de madurez y responsabilidades: trabajo, familia‚Ä¶</div>
        </div>
        
        <div class="stage-item">
          <div class="stage-range">+70 a√±os</div>
          <div class="stage-name">Ancianidad</div>
          <div class="stage-feature">Perdemos fuerza y agilidad. Es la √∫ltima etapa de la vida.</div>
        </div>
      </div>
      <div style="text-align: center;">
        <button class="btn btn-primary" id="startGameBtn">Jugar</button>
      </div>
    </div>
  </section>

  <!-- Game Screen -->
  <section class="screen" id="gameScreen">
    <div class="game-container">
      <header>
        <h1 class="title">Etapas de la vida</h1>
      </header>
      <div class="game-info">
        <div class="timer" id="timer">00:00</div>
        <div class="progress-bar" aria-label="Progreso"><div class="progress-fill" id="progressFill"></div></div>
        <div class="score">Puntos: <span id="score">0</span>/100</div>
      </div>
      <div class="level-indicator" id="levelIndicator">Nivel 1/2</div>
      <div class="game-instruction" id="gameInstruction">Selecciona el rango de edad correcto</div>
      <div class="quiz-container">
        <div class="quiz-question" id="quizQuestion"></div>
        <div class="quiz-options" id="quizOptions"></div>
      </div>
    </div>
  </section>

  <!-- Final Screen -->
  <section class="screen" id="resultsScreen">
    <header>
      <h1 class="final-title">Etapas de la vida</h1>
    </header>
    <div class="results">
      <div id="trophyBox" style="display:none;">
        <div class="trophy">üèÜ</div>
      </div>
      <div class="score-title">Tu puntuaci√≥n:</div>
      <div class="big-score" id="finalScore">0</div>
      <div class="final-time">Tiempo: <span id="finalTime">00:00</span></div>
      <div class="final-time">Aciertos: <span id="correctAnswers">0</span></div>
      <div class="final-time">Errores: <span id="wrongAnswers">0</span></div>
      <div id="finalMsg" class="subtitle"></div>
      <button class="btn btn-primary" id="backToMenuBtn" style="background:var(--orange);">Volver al men√∫</button>
      <span class="credit">Created by Manuel J. Ventura</span>
      <img class="school-logo" src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/main/Siurot.png" alt="Logo del colegio" />
    </div>
  </section>
</div>

<script>
// Audio setup
let soundEnabled = true;
let audioUnlocked = false;
const audioUrls = {
  correct: 'https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/7b86808e254100aeaba6285b3e0b82650ae78055/Correcto.mp3',
  error: 'https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/7b86808e254100aeaba6285b3e0b82650ae78055/Error.mp3',
  completed: 'https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/7b86808e254100aeaba6285b3e0b82650ae78055/Completado.mp3',
  victory: 'https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/7b86808e254100aeaba6285b3e0b82650ae78055/Termin%C3%A9.mp3',
  tap: 'https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/37b3eb2da9c15c04dfb71dfe1be60f088ea3cdfc/Tap.mp3'
};

const audioObjects = {};

// Create audio instances
Object.keys(audioUrls).forEach(key => {
  audioObjects[key] = new Audio(audioUrls[key]);
  audioObjects[key].preload = 'auto';
  audioObjects[key].volume = 1.0;
});

// Funci√≥n para desbloquear el audio
function unlockAudio() {
  if (audioUnlocked) return;
  
  // Intentar desbloquear el audio con un sonido silencioso
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    gainNode.gain.value = 0.001; // Volumen muy bajo
    oscillator.start();
    oscillator.stop(ctx.currentTime + 0.01);
    
    // Tambi√©n intentar reproducir el audio del tap
    audioObjects['tap'].play().then(() => {
      audioObjects['tap'].pause();
      audioObjects['tap'].currentTime = 0;
    }).catch(e => console.log("Audio unlock failed:", e));
    
    audioUnlocked = true;
  } catch (e) {
    console.warn("Web Audio API no disponible:", e);
    audioUnlocked = true;
  }
}

function playSound(soundType) {
  if (!soundEnabled || !audioObjects[soundType]) return;

  try {
    const audio = audioObjects[soundType];
    audio.currentTime = 0;
    
    // Si es la primera vez, intentar desbloquear el audio primero
    if (!audioUnlocked) {
      unlockAudio();
    }
    
    const playPromise = audio.play();
    
    if (playPromise !== undefined) {
      playPromise.then(_ => {
        // Reproducci√≥n exitosa
      }).catch(error => {
        console.log(`Audio play failed for ${soundType}:`, error);
      });
    }
  } catch (error) {
    console.log(`Audio error for ${soundType}:`, error);
  }
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('muteBtn').textContent = soundEnabled ? 'üîä' : 'üîá';
}

document.getElementById('muteBtn').onclick = toggleSound;

// Game state
let currentLevel = 1;
let currentQuestion = 0;
let correctAnswers = 0;
let wrongAnswers = 0;
let score = 0;
let gameStartTime = 0;
let timerInterval = null;
let gameData = {};

// Game definition
const game = {
  title: 'Etapas de la vida',
  stages: [
    {
      range: '0 ‚Äì 11',
      name: 'Infancia',
      feature: 'Pasamos de beb√©s a ni√±os y ni√±as.'
    },
    {
      range: '12 ‚Äì 15',
      name: 'Adolescencia',
      feature: 'Cambios f√≠sicos: vello corporal, barba, senos, etc.'
    },
    {
      range: '16 ‚Äì 25',
      name: 'Juventud',
      feature: 'Fin de los cambios f√≠sicos.'
    },
    {
      range: '26 ‚Äì 70',
      name: 'Adulto',
      feature: 'Per√≠odo de madurez y responsabilidades: trabajo, familia‚Ä¶'
    },
    {
      range: '+ 70',
      name: 'Ancianidad',
      feature: 'Perdemos fuerza y agilidad. Es la √∫ltima etapa de la vida.'
    }
  ],
  level1Options: ['0 ‚Äì 11', '12 ‚Äì 15', '16 ‚Äì 25', '26 ‚Äì 70', '+ 70'],
  level2Options: ['Infancia', 'Adolescencia', 'Juventud', 'Adulto', 'Ancianidad']
};

// Funci√≥n para mezclar array
function shuffleArray(array) {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
}

// Timer functions
function startTimer() {
  gameStartTime = Date.now();
  timerInterval = setInterval(updateTimer, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function updateTimer() {
  const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
  const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
  const seconds = (elapsed % 60).toString().padStart(2, '0');
  document.getElementById('timer').textContent = `${minutes}:${seconds}`;
}

function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60).toString().padStart(2, '0');
  const secs = (seconds % 60).toString().padStart(2, '0');
  return `${minutes}:${secs}`;
}

// Screen management
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(screen => {
    screen.classList.remove('active');
  });
  document.getElementById(screenId).classList.add('active');
}

function showTheory() {
  showScreen('theoryScreen');
}

function startGame() {
  currentLevel = 1;
  currentQuestion = 0;
  correctAnswers = 0;
  wrongAnswers = 0;
  score = 0;
  updateScore();

  // Mezclar las etapas aleatoriamente
  gameData.shuffledStages = shuffleArray(game.stages);
  
  showScreen('gameScreen');
  startTimer();
  showNextQuestion();
}

function showNextQuestion() {
  if (currentQuestion >= gameData.shuffledStages.length) {
    if (currentLevel === 1) {
      currentLevel = 2;
      currentQuestion = 0;
      document.getElementById('levelIndicator').textContent = 'Nivel 2/2';
      document.getElementById('gameInstruction').textContent = 'Selecciona el nombre de la etapa correcto';
      updateProgress(50);
      setTimeout(() => {
        showNextQuestion();
      }, 1000);
    } else {
      showFinalScreen();
    }
    return;
  }

  const currentStage = gameData.shuffledStages[currentQuestion];
  const question = currentStage.feature;
  const options = currentLevel === 1 ? game.level1Options : game.level2Options;
  const shuffledOptions = shuffleArray(options);

  document.getElementById('quizQuestion').textContent = question;
  
  const optionsContainer = document.getElementById('quizOptions');
  optionsContainer.innerHTML = '';
  
  shuffledOptions.forEach((option, index) => {
    const optionElement = document.createElement('div');
    optionElement.className = 'quiz-option';
    optionElement.textContent = option;
    optionElement.onclick = () => selectOption(option, currentStage);
    optionsContainer.appendChild(optionElement);
  });
}

function selectOption(selectedOption, correctStage) {
  const correctOption = currentLevel === 1 ? correctStage.range : correctStage.name;
  
  const optionElements = document.querySelectorAll('.quiz-option');
  optionElements.forEach(el => {
    el.onclick = null;
    el.style.pointerEvents = 'none';
  });

  if (selectedOption === correctOption) {
    playSound('correct');
    correctAnswers++;
    score += 10; // Cada acierto suma 10 puntos
  } else {
    playSound('error');
    wrongAnswers++;
    score = Math.max(0, score - 2); // Cada error resta 2 puntos, m√≠nimo 0
  }

  // Marcar la opci√≥n seleccionada
  optionElements.forEach(el => {
    if (el.textContent === selectedOption) {
      if (selectedOption === correctOption) {
        el.classList.add('correct');
      } else {
        el.classList.add('incorrect');
      }
    } else if (el.textContent === correctOption) {
      el.classList.add('correct');
    }
  });

  updateScore();
  
  // Reducir el tiempo de espera para mostrar aciertos/errores
  setTimeout(() => {
    currentQuestion++;
    const progress = ((currentLevel - 1) * 50 + (currentQuestion / gameData.shuffledStages.length) * 50);
    updateProgress(progress);
    showNextQuestion();
  }, 500); // Reducido de 1500ms a 500ms
}

function updateScore() {
  document.getElementById('score').textContent = score;
}

function updateProgress(percentage) {
  document.getElementById('progressFill').style.width = percentage + '%';
}

function showFinalScreen() {
  stopTimer();

  const elapsedSeconds = Math.floor((Date.now() - gameStartTime) / 1000);
  const timeStr = formatTime(elapsedSeconds);

  document.getElementById('finalScore').textContent = score;
  document.getElementById('finalTime').textContent = timeStr;
  document.getElementById('correctAnswers').textContent = correctAnswers;
  document.getElementById('wrongAnswers').textContent = wrongAnswers;

  if (score === 100) {
    document.getElementById('trophyBox').style.display = 'block';
    document.getElementById('finalMsg').textContent = '¬°Perfecto! Has acertado todas las preguntas.';
    playSound('victory');
    createConfetti();
  } else if (score >= 80) {
    document.getElementById('trophyBox').style.display = 'none';
    document.getElementById('finalMsg').textContent = '¬°Excelente trabajo! Has obtenido una gran puntuaci√≥n.';
    playSound('completed');
  } else if (score >= 60) {
    document.getElementById('trophyBox').style.display = 'none';
    document.getElementById('finalMsg').textContent = '¬°Buen trabajo! Sigue practicando para mejorar.';
    playSound('completed');
  } else {
    document.getElementById('trophyBox').style.display = 'none';
    document.getElementById('finalMsg').textContent = 'Sigue intent√°ndolo, la pr√°ctica hace al maestro.';
    playSound('completed');
  }

  showScreen('resultsScreen');
}

function createConfetti() {
  for(let i=0;i<120;i++){
    setTimeout(()=>{
      const c=document.createElement('div');
      c.className='confetti';
      const x=Math.random()*window.innerWidth;
      const ty=window.innerHeight+20;
      const tx=(Math.random()-.5)*160;
      const colors=['#ff595e','#1982c4','#6a4c93','#ffca3a','#8ac926','#ff924c','#00c2ff'];
      c.style.left=x+'px';
      c.style.top='-10px';
      c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
      const size=6+Math.random()*8;
      c.style.width=size+'px';
      c.style.height=size+'px';
      c.style.setProperty('--tx', tx+'px');
      c.style.setProperty('--ty', ty+'px');
      document.body.appendChild(c);
      setTimeout(()=>c.remove(), 3200);
    }, i*18);
  }
}

function backToMenu() {
  stopTimer();
  showScreen('startScreen');

  currentLevel = 1;
  currentQuestion = 0;
  correctAnswers = 0;
  wrongAnswers = 0;
  score = 0;
  gameData = {};
}

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
  showScreen('startScreen');

  // Event listeners
  document.getElementById('playBtn').addEventListener('click', function() {
    // Desbloquear audio primero
    unlockAudio();
    
    // Peque√±a demora para asegurar que el audio se desbloquee
    setTimeout(() => {
      playSound('tap');
      showTheory();
    }, 50);
  });

  document.getElementById('startGameBtn').addEventListener('click', function() {
    playSound('tap');
    startGame();
  });

  document.getElementById('backToMenuBtn').addEventListener('click', function() {
    playSound('tap');
    backToMenu();
  });

  // Audio unlock for mobile - intentar desbloquear en la primera interacci√≥n
  ['click', 'touchstart', 'keydown'].forEach(eventType => {
    document.addEventListener(eventType, function() {
      if (!audioUnlocked) {
        unlockAudio();
      }
    }, { once: true, passive: true });
  });
});
</script>
</body>
</html>